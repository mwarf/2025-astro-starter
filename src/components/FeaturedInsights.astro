---
import { getCollection } from 'astro:content';
import InsightCard from '@/components/InsightCard';

const insights = await getCollection('insights', ({ data }) => {
  return import.meta.env.PROD ? !data.draft && data.featured : data.featured;
});

const sortedInsights = insights
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3); // Show up to 3 featured insights
---

{sortedInsights.length > 0 && (
  <section class="py-16 bg-muted/50">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-3xl font-bold tracking-tight">Featured Insights</h2>
          <p class="text-muted-foreground mt-2">Latest thoughts and perspectives from our team</p>
        </div>
        <a href="/insights" class="text-primary hover:underline">
          View all insights â†’
        </a>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {sortedInsights.map(insight => (
          <InsightCard insight={insight} client:load />
        ))}
      </div>
    </div>
  </section>
)}
